"use strict";(self["webpackChunkvuejs_spa"]=self["webpackChunkvuejs_spa"]||[]).push([[138],{1803:function(e,a,t){t.d(a,{Z:function(){return c}});var n=t(3396),s=t(7139);const o={class:"context-options"};function l(e,a,t,l,i,r){return(0,n.wg)(),(0,n.iD)("div",{class:(0,s.C_)(["context-menu",{"context-active":this.active}])},[(0,n._)("div",{class:"context-header",ref:"header",onClick:a[0]||(a[0]=e=>this.active=!this.active)},[(0,n.WI)(e.$slots,"header",{},void 0,!0)],512),(0,n._)("ul",o,[(0,n.WI)(e.$slots,"options",{},void 0,!0)])],2)}var i={name:"contextMenu",data(){return{active:!1}},mounted(){document.addEventListener("click",this.close)},beforeUnmount(){document.removeEventListener("click",this.close)},methods:{close(e){this.$refs.header.contains(e.target)||(this.active=!1)}}},r=t(89);const d=(0,r.Z)(i,[["render",l],["__scopeId","data-v-2ecf1708"]]);var c=d},3138:function(e,a,t){t.r(a),t.d(a,{default:function(){return ce}});t(7658);var n=t(3396),s=t(7139),o=t(9242);const l=e=>((0,n.dD)("data-v-cb68e724"),e=e(),(0,n.Cn)(),e),i={class:"content x-center"},r={key:0,class:"xy-center-absolute"},d=l((()=>(0,n._)("span",{class:"primary-text font-size-large"},"Drag and drop your songs here",-1))),c={class:"form-checkbox",style:{width:"min-content"}},u=l((()=>(0,n._)("label",{for:"checkbox_makePlaylist"},"Make a playlist when multiple files are selected",-1))),p=["onClick"],g=["onChange"],m=["onClick"],h={class:"column gap-10"},b={class:"row gap-20"},f={class:"cover-wrapper s200x200"},v=["src"],_={key:1,class:"cover bi bi-music-note"},y=l((()=>(0,n._)("button",{type:"button",class:"button"},[(0,n._)("span",{class:"icon-text"},[(0,n._)("span",{class:"bi bi-camera-fill"}),(0,n._)("span",null,"Update cover")])],-1))),k=["onClick"],w=["onChange"],C=["onClick"],x={class:"column gap-10 w-100"},D={class:"form-field"},I=l((()=>(0,n._)("label",{for:"input_songName"},"Name",-1))),S=["onUpdate:modelValue"],U={key:0,class:"icon-text notification-error"},T=l((()=>(0,n._)("span",{class:"bi bi-exclamation-circle-fill"},null,-1))),A={class:"form-field"},E=l((()=>(0,n._)("label",{for:"input_songTags"},"Tags",-1))),F=["onUpdate:modelValue"],L={key:0,class:"icon-text notification-error"},P=l((()=>(0,n._)("span",{class:"bi bi-exclamation-circle-fill"},null,-1))),V=l((()=>(0,n._)("hr",null,null,-1))),j={class:"column gap-5"},q=l((()=>(0,n._)("span",{class:"primary-text font-size-medium"},"Artists",-1))),z={class:"column gap-15"},M={class:"row gap-10"},O={class:"form-field"},Z=["onUpdate:modelValue"],$={key:0,class:"icon-text notification-error"},N=l((()=>(0,n._)("span",{class:"bi bi-exclamation-circle-fill"},null,-1))),R={class:"form-field"},W=["onUpdate:modelValue"],H={key:0,class:"icon-text notification-error"},J=l((()=>(0,n._)("span",{class:"bi bi-exclamation-circle-fill"},null,-1))),K=["onClick"],Y={class:"row"},B=["disabled","onClick"],G={key:0,class:"icon-text notification-error"},Q=l((()=>(0,n._)("span",{class:"bi bi-exclamation-circle-fill"},null,-1))),X=l((()=>(0,n._)("span",null,"A maximum of 10 artists can be added to song.",-1))),ee=[Q,X],ae={class:"row right"},te=l((()=>(0,n._)("button",{type:"submit",class:"button button-primary hoverable"},"Upload",-1)));function ne(e,a,t,l,Q,X){const ne=(0,n.up)("contextMenu"),se=(0,n.up)("panel");return(0,n.wg)(),(0,n.iD)("div",i,[this.songs.length?((0,n.wg)(),(0,n.iD)("form",{key:1,class:"column column-main",onSubmit:a[8]||(a[8]=(0,o.iM)(((...e)=>X.submitLoadSongs&&X.submitLoadSongs(...e)),["prevent"]))},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(this.songs,((e,a)=>((0,n.wg)(),(0,n.j4)(se,null,{header:(0,n.w5)((()=>[(0,n.Uk)("Upload song")])),menu:(0,n.w5)((()=>[(0,n._)("button",{type:"button",class:"button button-secondary",onClick:e=>X.openSongAudioFileInput(a)},"Replace file",8,p),(0,n._)("input",{type:"file",ref_for:!0,ref:"songAudioInput",style:{display:"none"},onChange:e=>X.uploadSongAudioFile(e,a),accept:".mp3"},null,40,g),(0,n._)("button",{type:"button",class:"button button-default button-small bi bi-x-lg",onClick:e=>this.songs.splice(a,1)},null,8,m)])),content:(0,n.w5)((()=>[(0,n._)("div",h,[(0,n._)("div",b,[(0,n._)("div",f,[e.cover?((0,n.wg)(),(0,n.iD)("img",{key:0,id:"songCover",class:"cover",src:e.cover.url},null,8,v)):((0,n.wg)(),(0,n.iD)("div",_)),(0,n.Wm)(ne,{class:"x-center-absolute",style:{top:"50%","min-width":"120px"}},{header:(0,n.w5)((()=>[y])),options:(0,n.w5)((()=>[(0,n._)("li",null,[(0,n._)("button",{type:"button",class:"button",onClick:e=>X.openSongCoverFileInput(a)},"Upload image",8,k),(0,n._)("input",{type:"file",ref_for:!0,ref:"songCoverInput",style:{display:"none"},onChange:e=>X.uploadSongCoverFile(e,a),accept:"image/*"},null,40,w)]),(0,n._)("li",null,[(0,n._)("button",{type:"button",class:"button",onClick:a=>e.cover=null},"Delete image",8,C)])])),_:2},1024)]),(0,n._)("div",x,[(0,n._)("div",D,[I,(0,n.wy)((0,n._)("input",{id:"input_songName",type:"text",class:(0,s.C_)({"input-error":!1}),placeholder:"Enter song name","onUpdate:modelValue":a=>e.name.data=a},null,8,S),[[o.nr,e.name.data]]),e.name.error?((0,n.wg)(),(0,n.iD)("span",U,[T,(0,n._)("span",null,(0,s.zw)(e.name.error),1)])):(0,n.kq)("",!0)]),(0,n._)("div",A,[E,(0,n.wy)((0,n._)("input",{id:"input_songTags",type:"text",class:(0,s.C_)({"input-error":!1}),placeholder:"Up to 5 space-separated tags","onUpdate:modelValue":a=>e.tags.data=a},null,8,F),[[o.nr,e.tags.data]]),e.tags.error?((0,n.wg)(),(0,n.iD)("span",L,[P,(0,n._)("span",null,(0,s.zw)(e.tags.error),1)])):(0,n.kq)("",!0)])])]),V,(0,n._)("div",j,[q,(0,n._)("div",z,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.artists,((a,t)=>((0,n.wg)(),(0,n.iD)("div",M,[(0,n._)("div",O,[(0,n.wy)((0,n._)("input",{type:"text",placeholder:"Login","onUpdate:modelValue":e=>a.login.data=e},null,8,Z),[[o.nr,a.login.data]]),a.login.error?((0,n.wg)(),(0,n.iD)("span",$,[N,(0,n._)("span",null,(0,s.zw)(a.login.error),1)])):(0,n.kq)("",!0)]),(0,n._)("div",R,[(0,n.wy)((0,n._)("input",{type:"text",placeholder:"Pseudoname","onUpdate:modelValue":e=>a.pseudoname.data=e},null,8,W),[[o.nr,a.pseudoname.data]]),a.pseudoname.error?((0,n.wg)(),(0,n.iD)("span",H,[J,(0,n._)("span",null,(0,s.zw)(a.pseudoname.error),1)])):(0,n.kq)("",!0)]),(0,n._)("button",{type:"button",class:"button form-button bi bi-trash3-fill",onClick:a=>e.artists.splice(t,1)},null,8,K)])))),256))]),(0,n._)("div",Y,[(0,n._)("button",{type:"button",class:"button button-secondary",disabled:e.artists.length>=10,onClick:a=>e.artists.push({login:{data:null,error:null},pseudoname:{data:null,error:null}})}," Add artist ",8,B),e.artists.length>=10?((0,n.wg)(),(0,n.iD)("span",G,ee)):(0,n.kq)("",!0)])])])])),_:2},1024)))),256)),(0,n._)("div",ae,[(0,n._)("button",{type:"button",class:"button button-secondary",onClick:a[7]||(a[7]=e=>this.songs=[])},"Cancel"),te])],32)):((0,n.wg)(),(0,n.iD)("div",r,[(0,n._)("div",{class:(0,s.C_)(["drag-and-drop",{dragging:this.dragging}]),onDragenter:a[3]||(a[3]=(...e)=>X.dragenter&&X.dragenter(...e)),onDragover:a[4]||(a[4]=(...e)=>X.dragover&&X.dragover(...e)),onDragleave:a[5]||(a[5]=(...e)=>X.dragleave&&X.dragleave(...e)),onDrop:a[6]||(a[6]=(...e)=>X.drop&&X.drop(...e))},[d,(0,n._)("button",{type:"button",class:"button button-primary hoverable",onClick:a[0]||(a[0]=e=>this.$refs.songsInput.click())},"or choose files to upload"),(0,n._)("input",{type:"file",ref:"songsInput",style:{display:"none"},onChange:a[1]||(a[1]=(...e)=>X.fileInputChange&&X.fileInputChange(...e)),accept:".mp3",multiple:""},null,544),(0,n._)("div",c,[(0,n._)("button",{class:(0,s.C_)(["button button-checkbox",{"bi bi-check-square":!this.makePlaylist,"bi bi-check-square-fill toggled":this.makePlaylist}]),id:"checkbox_makePlaylist",onClick:a[2]||(a[2]=e=>this.makePlaylist=!this.makePlaylist)},null,2),u])],34)]))])}t(6229),t(7330),t(2062);var se=t(3278),oe=t(1417),le=t(1803),ie={name:"UploadView",components:{panel:oe.Z,contextMenu:le.Z},data(){return{validImageTypes:["image/gif","image/jpeg","image/png"],validAudioTypes:["audio/mpeg"],makePlaylist:!1,songs:[],dragging:!1,dragTime:void 0}},methods:{dragenter(e){const a=e.dataTransfer;(a?.types.indexOf?-1!=a?.types.indexOf("Files"):a?.types?.contains("Files"))&&(this.dragging=!0),this.dragTime=Date.now()},dragover(e){e.preventDefault()},dragleave(e){Date.now()-this.dragTime>25&&(this.dragging=!1,this.dragTime=void 0)},drop(e){e.preventDefault(),this.dragging=!1,this.dragTime=void 0,this.uploadSongs(e.dataTransfer.files)},fileInputChange(e){this.uploadSongs(e.target.files)},uploadSongs(e){this.songs=[];for(let a=0;a<e.length;a++)this.validAudioTypes.includes(e[a].type)&&this.songs.push({name:{data:e[a].name.split(".").slice(0,-1).join("."),error:null},tags:{data:"",error:null},artists:[],cover:null,audio:e[a]})},openSongAudioFileInput(e){this.$refs.songAudioInput[e].click()},uploadSongAudioFile(e,a){const t=e.target.files[0];t&&this.validAudioTypes.includes(t.type)&&(this.songs[a].audio=t)},openSongCoverFileInput(e){this.$refs.songCoverInput[e].click()},uploadSongCoverFile(e,a){const t=e.target.files[0];t&&this.validImageTypes.includes(t.type)&&(this.songs[a].cover={url:URL.createObjectURL(t),file:t})},async submitLoadSongs(){const e=this.songs.map((async e=>{e.name.data=e.name.data||null,e.name.error=null,e.name.data?(e.name.data=e.name.data.trim(),e.name.data.length>120&&(e.name.error="Enter a song name that is up to 120 characters.")):e.name.error="Enter a song name.",e.tags.data=e.tags.data||null,e.tags.error=null;let a=[];e.tags.data&&(e.tags.data=[...new Set(e.tags.data.trim().toLowerCase().replace("#","").replace(/\s+/g," ").split(" "))].join(" "),a=e.tags.data.split(" "),a.length>5&&(e.tags.error="Maximum 5 tags."),a.forEach((a=>{a.length>15&&(e.tags.error="One of tags is more than 15 characters.")}))),e.artists.forEach((e=>{e.login.data=e.login.data||null,e.login.error=null,e.login.data&&(e.login.data=e.login.data.trim().toLowerCase()),e.pseudoname.data=e.pseudoname.data||null,e.pseudoname.error=null,e.pseudoname.data&&(e.pseudoname.data=e.pseudoname.data.trim(),e.pseudoname.data.length>50&&(e.pseudoname.error="Enter a pseudoname that is up to 50 characters.")),e.login.data||e.pseudoname.data||(e.login.error="Enter an artist username/pseudoname.")}));const t=e.artists.some((e=>e.login.error||e.pseudoname.error));if(e.name.error||e.tags.error||t||e.artists.length>10)return;const n=new FormData;e.cover&&n.append("songCover",e.cover.file),n.append("songAudio",e.audio);const s=JSON.stringify({name:e.name.data,tags:a,artists:e.artists.map((e=>({login:e.login.data,pseudoname:e.pseudoname.data})))});n.append("songJSON",s);const o=await se.Z.post("me/songs/created",n);o.error?o.error.message.artistsError&&o.error.message.artistsError.forEach((a=>{e.artists[a.index].login.error=a.message})):e.uploaded=!0}));await Promise.all(e),this.songs=this.songs.filter((e=>!e.uploaded))}}},re=t(89);const de=(0,re.Z)(ie,[["render",ne],["__scopeId","data-v-cb68e724"]]);var ce=de}}]);
//# sourceMappingURL=138.7bc68c3b.js.map